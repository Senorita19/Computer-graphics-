<!doctype html>
<html>
  <head>
    <title>Wu's Line Drawing Algorithmsssss</title>
  </head>
  <body>
    <canvas
      id="canvas"
      width="600"
      height="400"
      style="border: 1px solid black"
    ></canvas>
    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      function ipart(x) {
        return Math.floor(x);
      }
      function round(x) {
        return Math.floor(x + 0.5);
      }
      function fpart(x) {
        return x - Math.floor(x);
      }
      function rfpart(x) {
        return 1 - fpart(x);
      }

      function plotAA(x, y, c) {
        ctx.fillStyle = `rgba(0,0,0,${c})`;
        ctx.fillRect(x, y, 1, 1);
      }

      function wuLine(x1, y1, x2, y2) {
        let steep = Math.abs(y2 - y1) > Math.abs(x2 - x1);
        if (steep) {
          [x1, y1] = [y1, x1];
          [x2, y2] = [y2, x2];
        }
        if (x1 > x2) {
          [x1, x2] = [x2, x1];
          [y1, y2] = [y2, y1];
        }

        let dx = x2 - x1;
        let dy = y2 - y1;
        let gradient = dy / dx;

        // First endpoint
        let xend = round(x1);
        let yend = y1 + gradient * (xend - x1);
        let xgap = rfpart(x1 + 0.5);
        let xpxl1 = xend;
        let ypxl1 = ipart(yend);
        if (steep) {
          plotAA(ypxl1, xpxl1, rfpart(yend) * xgap);
          plotAA(ypxl1 + 1, xpxl1, fpart(yend) * xgap);
        } else {
          plotAA(xpxl1, ypxl1, rfpart(yend) * xgap);
          plotAA(xpxl1, ypxl1 + 1, fpart(yend) * xgap);
        }
        let intery = yend + gradient;

        // Second endpoint
        xend = round(x2);
        yend = y2 + gradient * (xend - x2);
        xgap = fpart(x2 + 0.5);
        let xpxl2 = xend;
        let ypxl2 = ipart(yend);
        if (steep) {
          plotAA(ypxl2, xpxl2, rfpart(yend) * xgap);
          plotAA(ypxl2 + 1, xpxl2, fpart(yend) * xgap);
        } else {
          plotAA(xpxl2, ypxl2, rfpart(yend) * xgap);
          plotAA(xpxl2, ypxl2 + 1, fpart(yend) * xgap);
        }

        // Main loop
        if (steep) {
          for (let x = xpxl1 + 1; x < xpxl2; x++) {
            plotAA(ipart(intery), x, rfpart(intery));
            plotAA(ipart(intery) + 1, x, fpart(intery));
            intery += gradient;
          }
        } else {
          for (let x = xpxl1 + 1; x < xpxl2; x++) {
            plotAA(x, ipart(intery), rfpart(intery));
            plotAA(x, ipart(intery) + 1, fpart(intery));
            intery += gradient;
          }
        }
      }

      wuLine(300, 250, 500, 350);
    </script>
  </body>
</html>
